#!/bin/bash
####################################################################################
# Based on deployment guide (start services needed)

TYPE=production
PLONESCOREBOARD=
export ZOPE=Zope2-2.13.19-py2.7.egg
export JAVA_HOME=/usr/lib/jvm/java-1.6.0-openjdk.x86_64
export ELDAVERSION=1.2.16
export LD_LIBRARY_PATH="/usr/lib:LD_LIBRARY_PATH"
export PATH="/usr/local/bin:$PATH"

# Plone/Daviz (production)
#  Load Balancing

load_balance_production() {
    echo "Start Load Balancing Production"
    service scoreboard restart
}

# Zope (3 instances)
zope_production() {
    echo "Start Zope Production"
}

# Plone/Daviz (test)
load_balance_test() {
    echo "Start Load Balancing testing - nothing to do"
}

zope_test() {
    echo "Start Zope - testing"
    service scoreboardtest restart
}

# Memcached (production)
memcached_production() {
    echo "Stat memcached - production"
    # /var/local/plone-scoreboard/scoreboard.buildout/parts/memcached/bin/memcached -d -u scoreboard -P /var/local/plone-scoreboard/scoreboard.buildout/parts/memcached/memcached.pid -p 11210 -m 8192 &
}

# Memcached (test)
memcached_test() {
    echo "Stat memcached - test"
    # /var/local/plone-scoreboard/scoreboard.buildout.test/parts/memcached/bin/memcached -d -u scoreboard -P /var/local/plone-scoreboard/scoreboard.buildout.test/parts/memcached/memcached.pid -p 11211 -m 1024 &
}

# Virtuoso (production)
virtuoso_production() {
    echo "Stat virtuoso - production"
    service virtuoso restart
    sleep 10
}

# Virtuoso (test)
virtuoso_test() {
    echo "Stat virtuoso - test"
    service virtuosotest restart
    sleep 10
}

# Content Registry (production)
content_registry_production() {
    echo "Stat content repository - production"
    service tomcat6 restart
    # java -Djava.util.logging.config.file=/var/local/cr/apache-tomcat-6.0.36/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Xmx2048m -Djava.endorsed.dirs=/var/local/cr/apache-tomcat-6.0.36/endorsed -classpath /var/local/cr/apache-tomcat-6.0.36/bin/bootstrap.jar -Dcatalina.base=/var/local/cr/apache-tomcat-6.0.36 -Dcatalina.home=/var/local/cr/apache-tomcat-6.0.36 -Djava.io.tmpdir=/var/local/cr/apache-tomcat-6.0.36/temp org.apache.catalina.startup.Bootstrap start &
}

# Content Registry (test)
content_registry_test() {
    echo "Stat content repository - test"
    # service tomcat6 restart
    # java -Djava.util.logging.config.file=/var/local/crtest/apache-tomcat-6.0.36/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Xmx1024m -Djava.endorsed.dirs=/var/local/crtest/apache-tomcat-6.0.36/endorsed -classpath /var/local/crtest/apache-tomcat-6.0.36/bin/bootstrap.jar -Dcatalina.base=/var/local/crtest/apache-tomcat-6.0.36 -Dcatalina.home=/var/local/crtest/apache-tomcat-6.0.36 -Djava.io.tmpdir=/var/local/crtest/apache-tomcat-6.0.36/temp org.apache.catalina.startup.Bootstrap start &
}

# Elda Standalone Package

elda_test() {
    echo "Start EDLA - testing"
    ( cd /var/local/Elda_standalone_${ELDAVERSION}/elda_standalone_${ELDAVERSION} ; java -jar start.jar )
    sleep 10
}

elda_production() {
    echo "Start EDLA - production /var/local/Elda_standalone_${ELDAVERSION}/elda_standalone_${ELDAVERSION}"
    ( cd /var/local/Elda_standalone_${ELDAVERSION}/elda_standalone_${ELDAVERSION} ; java -jar start.jar )
    sleep 10
}

# Start all the required services

start_processes() {
    service httpd restart
    virtuoso_${TYPE};
    load_balance_${TYPE}; 
    memcached_${TYPE};
    content_registry_${TYPE};
    zope_${TYPE};
    elda_${TYPE}
}

echo "start all processes"
start_processes

